//TODO derive from bare_api.c